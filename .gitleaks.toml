# Gitleaks configuration for OxiCleanarr
title = "OxiCleanarr Secret Scanning"

# Extend default gitleaks config
[extend]
useDefault = true

# Custom rules for OxiCleanarr specific patterns
[[rules]]
id = "jellyfin-api-key"
description = "Jellyfin API Key"
regex = '''(?i)(?:jellyfin|emby)[_-]?(?:api[_-]?)?key[_- \t]*[:=][ \t]*['"]*([a-f0-9]{32})['"]*'''
tags = ["api-key", "jellyfin"]

[[rules]]
id = "radarr-api-key"
description = "Radarr API Key"
regex = '''(?i)radarr[_-]?(?:api[_-]?)?key[_- \t]*[:=][ \t]*['"]*([a-f0-9]{32})['"]*'''
tags = ["api-key", "radarr"]

[[rules]]
id = "sonarr-api-key"
description = "Sonarr API Key"
regex = '''(?i)sonarr[_-]?(?:api[_-]?)?key[_- \t]*[:=][ \t]*['"]*([a-f0-9]{32})['"]*'''
tags = ["api-key", "sonarr"]

[[rules]]
id = "jellyseerr-api-key"
description = "Jellyseerr API Key"
regex = '''(?i)jellyseerr[_-]?(?:api[_-]?)?key[_- \t]*[:=][ \t]*['"]*([A-Za-z0-9+/]{40,}={0,2})['"]*'''
tags = ["api-key", "jellyseerr"]

[[rules]]
id = "generic-api-key-in-config"
description = "Generic API Key in config files"
regex = '''(?i)api[_-]?key[_- \t]*[:=][ \t]*['"]*([a-f0-9]{32,}|[A-Za-z0-9+/]{40,}={0,2})['"]*'''
tags = ["api-key", "generic"]
# Only scan specific file types to reduce false positives
[rules.allowlist]
paths = [
  '''.*_test\.go$''',           # Test files often have mock keys
  '''.*\.example$''',           # Example files are safe
  '''.*\.md$''',                # Documentation
  '''test/.*''',                # Test directories
]

[[rules]]
id = "jwt-secret"
description = "JWT Secret"
regex = '''(?i)jwt[_-]?secret[_- \t]*[:=][ \t]*['"]*([A-Za-z0-9+/=]{32,})['"]*'''
tags = ["jwt", "secret"]

# Allowlist for known safe patterns
[allowlist]
description = "Allowlist for safe patterns"
paths = [
  '''config/config\.yaml\.example$''',  # Example config is safe
  '''\.gitleaks\.toml$''',              # This file
  '''\.github/workflows/.*''',          # CI/CD configs
  '''.*_test\.go$''',                   # Test files with mock data
  '''test/.*\.go$''',                   # Integration test helpers
]

# Allowlist specific test values
regexes = [
  '''test-api-key-[a-z0-9]{8}''',      # Test API keys
  '''mock[_-]?(?:api[_-]?)?key''',     # Mock keys
  '''fake[_-]?(?:api[_-]?)?key''',     # Fake keys
  '''example[_-]?(?:api[_-]?)?key''',  # Example keys
  '''your[_-]?(?:api[_-]?)?key''',     # Placeholder text
  '''[a-f0-9]{8}(-[a-f0-9]{4}){3}-[a-f0-9]{12}''',  # UUIDs are not secrets
]

# Stopwords for additional context
stopwords = [
  'test',
  'mock',
  'fake',
  'example',
  'sample',
  'placeholder',
  'dummy',
]
